# db2-prototypes

Throw away repo containing scripts and benchmarks of data import and querying from VIMC 2.0 database. For testing we will import data for 2022110gavi-3 touchstone for YF with 3 countries AGO, BEN and BFA.

How can we expect this to scale with more touchstones, more diseases and more countries?

## Start DB

```
docker volume create pgdata
docker run --name experiment -p 5432:5432 -v pgdata:/var/lib/postgresql/data -v "${PWD}":/src -e POSTGRES_PASSWORD=password -d postgres
```

If you want to remove the data then remove the pgdata volume

## Imports

* 2022-03-14_central_import - contains script to pull centrals from montagu API and then script to add to format and import into the database
* 2022-03-15_stochastic_import - contains db import to upload stochastics from raw files into database. This transforms to a common pattern but does no aggregation
* 2022-03-24_measles_central_import - contains script to pull centrals from montagu API and then script to format and import into database
* 2022-03-24_measles_stochastic_import - contains db import to upload stochastics from raw files into database. Transforms to a common pattern but does no aggregation
* 2022-03-16_aggregate_burden_estimate_age - pulls age disaggregated data from database, aggregates over age and upload as `stochastic_n` tables
* 2022-04-04_impact - generates impact estimates from burden estimates, creating cross_all, cohort_all, cross_under5, cohort_under5, intervention_all and bootstrap tables
* 2022-04-04_impact_without_double_counting - runs bootstrapping on impact tables to add tables impact_cluster_cohort_all, impact_cluster_cohort_under5, impact_cluster_cross_all, impact_cluster_cross_under5

For timings of imports, in each import directory see `timings.txt`. These were all generated by running the import script from the experimental database VM.

![diagram](diagrams/imports.png)
